const fields={cash:document.getElementById("cash"),tradingGoods:document.getElementById("trading_goods"),debts:document.getElementById("debts"),liabilities:document.getElementById("liabilities"),goldPrice:document.getElementById("gold_price"),totalMoney:document.getElementById("total_zakat"),nisab:document.getElementById("nisab"),zakatAmount:document.getElementById("zakat_amount"),hijri:document.getElementById("hijri"),miladi:document.getElementById("miladi")};let zakatPercentage=2.5;const fieldsToUpdateTotalMoney=[fields.cash,fields.tradingGoods,fields.debts,fields.liabilities],fieldsToUpdateNisab=[fields.goldPrice];function calculateTotalMoney(){if(""!=fields.cash.value||""!=fields.tradingGoods.value||""!=fields.debts.value||""!=fields.liabilities.value){return((parseFloat(removeCommas(fields.cash.value))||0)+(parseFloat(removeCommas(fields.tradingGoods.value))||0)+(parseFloat(removeCommas(fields.debts.value))||0)-(parseFloat(removeCommas(fields.liabilities.value))||0)).toFixed(2)}return""}function calculateNisab(){const e=parseFloat(removeCommas(fields.goldPrice.value))||0;return""!=fields.goldPrice.value?(85*e).toFixed(2):""}function calculateZakat(e,t){if(""!=fields.totalMoney.value&&""!=fields.nisab.value){const a=parseFloat(e);return a>=parseFloat(t)?(a*zakatPercentage/100).toFixed(2):"لا زكاة - وعاء الزكاة لم يبلغ النصاب"}return""}function formatNumberWithCommas(e){let t="object"==typeof e?e.value:e;const a=t.startsWith("-");t=t.replace(/[^0-9.]/g,"");const l=t.split(".");l[0]=l[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");const o=(a?"-":"")+l.join(".");return"object"==typeof e&&(e.value=o),o}function removeCommas(e){return e.replace(/,/g,"")}function validateInput(e){let t=e.value;const a={"٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9"};t=t.replace(/[٠-٩]/g,(e=>a[e])),t=t.replace(/[^0-9.]/g,"");const l=t.split(".");l.length>2&&(t=l[0]+"."+l.slice(1).join("")),e!==fields.goldPrice?l.length>1&&l[1].length>2&&(t=l[0]+"."+l[1].slice(0,2)):l.length>1&&l[1].length>5&&(t=l[0]+"."+l[1].slice(0,5));parseFloat(t)>1e15&&(t=t.slice(0,-1)),e.value=t}function clearAll(){Object.values(fields).forEach((e=>{"INPUT"===e.tagName&&"text"===e.type&&(e.value="")})),fields.hijri.checked=!0,zakatPercentage=2.5}function openModal(e){var t=document.getElementById("tipModal"),a=document.getElementById("modalText"),l={tip1:{title:"ركز في نيتك عند إخراج الأموال\nوفَرِّق بين النذر والصدقة والزكاة",content:"1- النذر: ما نذرته لله وكفارته ككفارة اليمين.\n2- الصدقة: في أي وقت لأي شخص غني أو فقير.\n3- الزكاة: عند بلوغ المال النصاب ومرور الحول ولها مصارفها ولا تسقط بالتقادم بل تعود لحسابها ولو بشكل تقديري قدر المستطاع وتخرجها حسب المتاح معك من سيولة خلال العام."},tip2:{title:"مصارف الزكاة",content:"1- الفقراء: من لا يجد شيء.\n2- المساكين: الذي يجد بعض ما يكفيه.\n3- العاملين عليها: المكلف بجبايتها وتوزيعها.\n4- المؤلفة قلوبهم: من دخل في الإسلام وكان في حاجة إلى تأليف قلبه.\n5- الرقاب: عتق المسلم عبدًا كان أو أمة، و فك الأسرى ومساعدة المكاتبين.\n6- الغارمين: من استدان في غير معصية وليس عنده سداد دينه، ومن غرم في صلحٍ مشروع.\n7- في سبيل الله: المجاهدين والمرابطين في سبيل الله.\n8- ابن السبيل: مسافر أنقطعت به الأسباب عن بلده وماله فيعان على الرجوع لبلده بما يحتاج."}};modalTitle.textContent=l[e].title,a.textContent=l[e].content,t.style.display="block"}function closeModal(){document.getElementById("tipModal").style.display="none"}function scrollUp(){window.scrollBy({top:-window.innerHeight,left:0,behavior:"smooth"}),updateScrollButtons()}function scrollDown(){window.scrollBy({top:window.innerHeight,left:0,behavior:"smooth"}),updateScrollButtons()}function updateScrollButtons(){var e=document.getElementById("scrollUpBtn"),t=document.getElementById("scrollDownBtn");0===window.scrollY?e.classList.add("hidden"):e.classList.remove("hidden");const a=document.documentElement.scrollHeight-window.innerHeight;Math.ceil(window.scrollY)>=a?t.classList.add("hidden"):t.classList.remove("hidden")}fieldsToUpdateTotalMoney.forEach((e=>{e.addEventListener("input",(function(){validateInput(e),formatNumberWithCommas(e);const t=calculateTotalMoney(),a=calculateNisab(),l=""!==t?formatNumberWithCommas(t):"";if(fields.totalMoney.value!==l&&(fields.totalMoney.value=l,fields.totalMoney.classList.add("readonly-updated"),setTimeout((()=>fields.totalMoney.classList.remove("readonly-updated")),1e3)),""!=fields.totalMoney.value&&""!=fields.nisab.value){const e=calculateZakat(t,a);fields.zakatAmount.value=e>=0?formatNumberWithCommas(e):e}}))})),fieldsToUpdateNisab.forEach((e=>{e.addEventListener("input",(function(){validateInput(e),formatNumberWithCommas(e);const t=calculateNisab(),a=""!==t?formatNumberWithCommas(t):"";fields.nisab.value!==a&&(fields.nisab.value=a,fields.nisab.classList.add("readonly-updated"),setTimeout((()=>fields.nisab.classList.remove("readonly-updated")),1e3));const l=calculateTotalMoney();if(""!=fields.totalMoney.value&&""!=fields.nisab.value){const e=calculateZakat(l,t);fields.zakatAmount.value=e>=0?formatNumberWithCommas(e):e}}))})),fields.hijri.addEventListener("change",(function(){if(fields.hijri.checked){zakatPercentage=2.5;const e=calculateTotalMoney(),t=calculateNisab();if(e&&t){const a=calculateZakat(e,t);fields.zakatAmount.value=a>=0?formatNumberWithCommas(a):a}}})),fields.miladi.addEventListener("change",(function(){if(fields.miladi.checked){zakatPercentage=2.577;const e=calculateTotalMoney(),t=calculateNisab();if(e&&t){const a=calculateZakat(e,t);fields.zakatAmount.value=a>=0?formatNumberWithCommas(a):a}}})),window.onload=updateScrollButtons,window.onscroll=updateScrollButtons;